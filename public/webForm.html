<!DOCTYPE html>
<html lang="en">

<head>
    <title>CSB Capstone Portal</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <link rel="stylesheet" href="css/materialize.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
</head>
<body>
<main>
    <!--
    <div class="container row">
        <div class="row center-align">
            <div class="col s12">
                <div class="divider"></div>
            </div>
        </div>
        <div class="row center-align">

            <div class="col s4 ">

                <div class="input-field col">

                    <button style="cursor:default" class="waves-effect waves-light btn modal-trigger btn-custom" id="modal_id"
                            onclick="click_comp(1)">Add Company
                    </button>
                    <button  style="cursor:default" hidden="true" class="waves-effect waves-light btn modal-trigger btn-custom" id="modal01_"
                             href="#modal1">Add New Company
                    </button>
                    <button  style="cursor:default" hidden="true" class="waves-effect waves-light btn modal-trigger btn-custom" id="modal02_"
                             href="#modal2">Add Engagement
                    </button>

                    <!-- onclick="clickModal1()"
                </div>
            </div>
        </div>
    </div>
    -->




    <!--Form Stuff-->
        <div class="modal-content">
        <h4 id="modal-heading">Add New Company</h4>
        <form class="col s12" name="frm_business" id='frm_business' onsubmit="return false">
            <div class="row none-marg" hidden>
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Id" id="Business_id" type="text">
                    <label for="Business_id">Company Id</label>
                </div>
            </div>
            <div class="row none-marg ">
                <label> * Denotes Required Fields</label>
            </div>
            <div class="row none-marg ">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Name" id="Business_Name" type="text" class="validate">
                    <label for="Business_Name">Company Name *</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Email" id="Business_Email" type="text" class="validate ">
                    <label for="Business_Email">Company Email *</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Phone Number" id="Business_Phone" type="tel" class="validate">
                    <label for="Business_Phone">Company Phone Number</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Address" id="business_address" type="text" class="validate">
                    <label for="business_address">Company Address</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Industry" id="business_industry" type="text" class="validate">
                    <label for="business_industry">Company Industry</label>
                </div>
            </div>
            <div class="row" id="business_submit_row">
            </div>

        </form>
    </div>

    <div class="row" id="business_submit_row">
   <div class="input-field col" style="float: right">
     <button  style="cursor:default"name="Close" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Cancel</button>
     <button  style="cursor:default" type="submit" name="Submit" onclick="createBusiness()" class="waves-effect waves-light btn modal-trigger">Submit</button>
      </div>
   </div>

    <div class="col-md-12 center text-center">
        <span class="left" id="total_reg"></span>
        <ul class="pagination pager" id="myPager"></ul>
    </div>


<!--End Form Stuff-->



</main>

<!--
<div id="modal1" class="modal">
    <div class="modal-content">
        <h4 id="modal-heading">Add New Company</h4>
        <form class="col s12" name="frm_business" id='frm_business' onsubmit="return false">
            <div class="row none-marg" hidden>
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Id" id="Business_id" type="text">
                    <label for="Business_id">Company Id</label>
                </div>
            </div>
            <div class="row none-marg ">
                <label> * Denotes Required Fields</label>
            </div>
            <div class="row none-marg ">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Name" id="Business_Name" type="text" class="validate">
                    <label for="Business_Name">Company Name *</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Email" id="Business_Email" type="text" class="validate ">
                    <label for="Business_Email">Company Email *</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Phone Number" id="Business_Phone" type="tel" class="validate">
                    <label for="Business_Phone">Company Phone Number</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Address" id="business_address" type="text" class="validate">
                    <label for="business_address">Company Address</label>
                </div>
            </div>
            <div class="row none-marg">
                <div class="input-field col" style="width: 100%">
                    <input placeholder="Company Industry" id="business_industry" type="text" class="validate">
                    <label for="business_industry">Company Industry</label>
                </div>
            </div>
            <div class="row" id="business_submit_row">
            </div>

        </form>
    </div>
    <div class="col-md-12 center text-center">
        <span class="left" id="total_reg"></span>
        <ul class="pagination pager" id="myPager"></ul>
    </div>
</div>
-->

</body>

<!--  Scripts-->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="js/materialize.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
<script src="js/templates.js"></script>
<script src="js/init.js"></script>
<script src="js/utilityScript.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js'></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
<script>
    var businessData = [];
    var createCompany = 'company_create';
    var editCompany = 'company_edit';
    var deleteCompany = 'company_delete';

    // getting the business by id
    var successAjaxMessageCompany = 'Company created successfully!';
    // the error or something went wrong because of the ajax connection
    var errorAjaxMessageCompany = 'Something went wrong in connection';
    var updatesuccessAjaxMessageCompany = 'Company updated successfully!';


    $('.modal-trigger').leanModal();


    $(document).ready(function () {
        $('#modal02_').hide();
        $('#modal01_').hide();

        if (sessionStorage.submit_status) {
            // sessionStorage.submit_status = '';
        } else {
            sessionStorage.submit_status = createCompany;
        }
        // load data to the company list
        doGetList(-1);
        // update the button of 'Add New Company' popup button on initial load
        update_button();

        // adding create or a update & delete button to the frm_business area
        //check the globally defined g_status_txt value

    });
    var searchText;

    $('#txtSearch').on("input", function () {
        if ($(this).val()) {
            searchText = $(this).val().trim().toLowerCase();
            var data = {
                businessName: searchText,
                businessEmail: searchText,
                businessIndustry: searchText,
                clientName: searchText,
                clientEmail: searchText
            };
            doGetList(-1, data);
        } else if (searchText !== "" && !$(this).val()) {
            doGetList(-1);
        }
    });

    function createBusiness() {
        if (document.forms['frm_business'].Business_Name.value == "") {
            showToast('Please Enter A Company name!');
            return;
        }
        formData = {
            "businessName": document.forms['frm_business'].Business_Name.value,
            "businessEmail": document.forms['frm_business'].Business_Email.value,
            "businessIndustry": document.forms['frm_business'].business_industry.value,
            "businessAddress": document.forms['frm_business'].business_address.value,
            "businessPhoneNumber": document.forms['frm_business'].Business_Phone.value

        };

        if (formData.businessEmail === "") {
            showToast("Please Enter an Email");
            return;
        }

        if ((formData.businessEmail.search("@") == -1) || (formData.businessEmail.search(".co") == -1)) {
            showToast("Please Enter A Valid Email");
            return;
        }


        doPostRequest("/businesses/create", formData,
            function () {
                alert("Company created successfully!");
                $("#modal1").css('display', 'none');
                window.location.reload();
            },
            function (e) {
                console.log(e);
            }
        );
    }

    function callEdit(companyId) {
        $(".form_key").prop("readonly", true);
        sessionStorage.submit_status = editCompany;
        update_button();
        doGetRequest("/businesses/" + companyId, undefined, function (data) {
//            console.log(data);

            //for (var i = 0; i < data.length; i++) {
            //f (data[i].businessId == companyName) {
            document.forms['frm_business'].Business_id.value = data.businessId;
            document.forms['frm_business'].Business_Name.value = data.businessName;
            document.forms['frm_business'].Business_Email.value = data.businessEmail;
            document.forms['frm_business'].business_industry.value = data.businessIndustry;
            // there values were not defiend in the search so need to check if it is correct
            document.forms['frm_business'].business_address.value = data.businessAddress;
            document.forms['frm_business'].Business_Phone.value = data.businessPhoneNumber;
            $('#modal01_').trigger('click');
        });
    }
    function calEdit(companyId) {
        $(".form_key").prop("readonly", true);
//        sessionStorage.submit_status = editCompany;
//        update_button();
        doGetRequest("/businesses/" + companyId, undefined, function (data) {
//            console.log(data);

            //for (var i = 0; i < data.length; i++) {
            //f (data[i].businessId == companyName) {
            document.forms['frm_business'].Business_id.value = data.businessId;
            document.forms['frm_business'].Business_Name.value = data.businessName;
            document.forms['frm_business'].Business_Email.value = data.businessEmail;
            document.forms['frm_business'].business_industry.value = data.businessIndustry;
            // there values were not defiend in the search so need to check if it is correct
            document.forms['frm_business'].business_address.value = data.businessAddress;
            document.forms['frm_business'].Business_Phone.value = data.businessPhoneNumber;
//            $('#modal_id').trigger('click');
        });
    }

    function doEdit() {
        var companyId = document.forms['frm_business'].Business_id.value;
        formData = {
            businessName: document.forms['frm_business'].Business_Name.value,
            businessEmail: document.forms['frm_business'].Business_Email.value,
            businessIndustry: document.forms['frm_business'].business_industry.value,
            businessAddress: document.forms['frm_business'].business_address.value,
            businessPhoneNumber: document.forms['frm_business'].Business_Phone.value
        };

        // var formData = JSON.stringify($("#frm_business").serializeArray());
        doPostRequest("/businesses/edit/" + companyId, formData,
            function () {
                alert(updatesuccessAjaxMessageCompany);
                window.location.reload();
            });
    }




    function update_button() {
        var html = '';

        $('#business_submit_row').append(html);
        if (sessionStorage.submit_status == createCompany) {
            $("#modal-heading").html('Add New Company');
            ResetForm();
            // generating the submit button to the popup
            html += '<div class="row" id="business_submit_row">';
            html += '<div class="input-field col" style="float: right">';
            html += '<button  style="cursor:default"name="Close" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Cancel</button>';
            html += '<button  style="cursor:default" type="submit" name="Submit" onclick="createBusiness()" class="waves-effect waves-light btn modal-trigger">Submit</button>';
            html += '</div>';
            html += '</div>';
            hiding();
        }

        else if (sessionStorage.submit_status == editCompany) {
            $("#modal-heading").html('Edit Company');
            //  generating the edit and delete to the popup
            html += '<div class="row" id="business_submit_row">';
            html += '<div class="input-field col" style="float: right">';
            html += '<button style="cursor:default" name="Close" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Cancel</button>';
            html += '<button style="cursor:default" type="submit"  name="Submit" onclick="doEdit(this)" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Update</button>';
            html += '</div>';
            html += '</div>';
            hiding();
        } else {
            // generating the submit button to the popup
            html += '<div class="row" id="Engagements_submit_row">';
            html += '<div class="input-field col" style="float: right">';
            html += '<button style="cursor:default" name="Close" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Cancel</button>';
            html += '<button style="cursor:default" type="submit" name="Submit" onclick="doDelete(this)" class="modal-action modal-close waves-effect waves-light btn modal-trigger">Delete</button>';
            html += '</div>';
            html += '</div>';
            hiding();
        }

        // appending the generated buttons to popup
        $('#business_submit_row').replaceWith(html);
    }

    function hiding() {
        $('.hiding').hide();
    }

    function click_comp(con) {
        $("#modal-heading").html('Add New Company');
        ResetForm();
        sessionStorage.submit_status = createCompany;
        update_button();

        $("#modal01_").trigger("click");
    }
    function ResetForm() {
        document.forms['frm_business'].Business_id.value = "";
        document.forms['frm_business'].Business_Name.value = "";
        document.forms['frm_business'].Business_Email.value = "";
        document.forms['frm_business'].business_industry.value = "";
        document.forms['frm_business'].business_address.value = "";
        document.forms['frm_business'].Business_Phone.value = "";
        $("#Business_id").val('');
        $("#Business_Name").val('');
        $("#Business_Email").val('');
        $("#business_industry").val('');
        $("#business_address").val('');
        $("#Business_Phone").val('');

    }

</script>

</body>
</html>